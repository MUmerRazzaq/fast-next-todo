# Docker Compose Guide

Docker Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a YAML file to configure your application's services. Then, with a single command, you create and start all the services from your configuration.

A template `docker-compose.yml` is available at `assets/docker-compose-template/docker-compose.yml`.

## Table of Contents
- [Services](#services)
- [Volumes](#volumes)
- [Networks](#networks)
- [Environment Variables](#environment-variables)
- [Healthchecks](#healthchecks)
- [depends_on](#depends_on)

## Services

A service is a container in your application. It's defined by a name (e.g., `backend`, `frontend`, `db`) and a configuration. The configuration includes the base image to use, the build context, ports to expose, volumes to mount, and more.

### Example
```yaml
services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
```

## Volumes

Volumes are used to persist data generated by and used by Docker containers. You can mount a host path or a named volume.

- **Host path mount**: ` - ./backend:/app` This mounts the `./backend` directory from the host into the `/app` directory in the container. This is great for development, as changes to your code on the host are immediately reflected in the container.
- **Named volume**: ` - postgres_data:/var/lib/postgresql/data/` This uses a named volume `postgres_data` to persist the database data. Docker manages named volumes.

```yaml
services:
  db:
    image: postgres:13-alpine
    volumes:
      - postgres_data:/var/lib/postgresql/data/

volumes:
  postgres_data:
```

## Networks

Docker Compose sets up a single default network for your app. Each container for a service joins the default network and is both reachable by other containers on that network, and discoverable by them at a hostname identical to the container name.

For example, the `backend` service can connect to the `db` service at the hostname `db`.

## Environment Variables

You can pass environment variables to your services in a few ways:

- **`environment` key**: A list of key-value pairs.
- **`.env` file**: Compose automatically looks for a `.env` file in the project directory and makes the variables available in the `docker-compose.yml` file and to the services.

```yaml
services:
  backend:
    environment:
      - DATABASE_URL=postgresql://user:password@db:5432/mydatabase
      - SECRET_KEY=your-secret-key
```

## Healthchecks

A healthcheck is a command that Docker runs inside a container to check if it's healthy. This is useful for services that depend on each other. You can use `depends_on` with `service_healthy` to wait for a service to be healthy before starting another service.

```yaml
services:
  db:
    image: postgres:13-alpine
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U user -d mydatabase"]
      interval: 10s
      timeout: 5s
      retries: 5
```

## depends_on

`depends_on` lets you express dependency between services. Compose starts dependencies in order. With the `condition` key, you can specify that a service should only start when another service is healthy.

```yaml
services:
  backend:
    depends_on:
      db:
        condition: service_healthy
```
